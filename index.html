<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8">
  <title>Tic Tac Toe Multiplayer & AI (X-O)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root {
      --main-blue: #3775dd;
      --main-pink: #fa5a72;
      --main-green: #1fa960;
      --main-yellow: #ffe68a;
    }
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      min-height: 100vh;
      min-width: 100vw;
      background: radial-gradient(circle at 80% 10%, #ff48c7 0 18%, #ffd6e0 40%, #291a6d 100%),
                  radial-gradient(ellipse at 0% 100%, #d2eaff 0 22%, #9be7ff 60%, #291a6d 100%),
                  linear-gradient(120deg, #2b32b2 0%, #1488cc 100%);
      position: relative;
      font-family: 'Segoe UI', Arial, sans-serif;
      overflow-x: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    body::before {
      content: "";
      position: fixed;
      left: 0; right: 0; top: 0; bottom: 0;
      z-index: 0;
      background: 
        repeating-linear-gradient(120deg,rgba(255,255,255,0.06) 0 2px,rgba(0,0,0,0) 2px 60px),
        linear-gradient(100deg,rgba(255,255,255,0.08) 5%,rgba(41,16,85,0.25) 95%);
      pointer-events: none;
      animation: aurora-move 14s ease-in-out infinite alternate;
    }
    @keyframes aurora-move {
      0% {filter: blur(22px) hue-rotate(0deg);}
      100% {filter: blur(28px) hue-rotate(35deg);}
    }
    body::after {
      content: "";
      pointer-events: none;
      position: fixed;
      left: 0; right: 0; top: 0; bottom: 0;
      z-index: 0;
      background-image: 
        repeating-radial-gradient(circle at 20% 30%, #fff9 0 0.6px, transparent 1.5px 100px),
        repeating-radial-gradient(circle at 70% 60%, #fff5 0 1.2px, transparent 2.5px 120px),
        repeating-radial-gradient(circle at 90% 10%, #fff6 0 0.8px, transparent 1.5px 70px);
      animation: stars-move 40s linear infinite;
      opacity: 0.7;
    }
    @keyframes stars-move {
      0% {background-position: 0 0,0 0,0 0;}
      100% {background-position: 60px 40px, -80px 0px, 100px 60px;}
    }

    .container {
      min-height: 100vh;
      width: 100vw;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 3vw 0 3vw 0;
    }
    .panel {
      background: rgba(255,255,255,0.97);
      border-radius: 28px;
      box-shadow: 0 8px 36px #0004, 0 1.5px 8px #3775dd33;
      position: relative;
      z-index: 1;
      backdrop-filter: blur(3.3px);
      border: 2.5px solid #fff8;
      max-width: 425px;
      width: 92vw;
      padding: 32px 18px 30px 18px;
      margin: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    h1 {
      text-align:center;
      letter-spacing: 1.5px;
      color: var(--main-blue);
      margin-top: 0;
      margin-bottom: 18px;
      font-size: 2.15em;
      font-weight: 800;
      background: linear-gradient(90deg, #fff 10%, var(--main-blue) 50%, var(--main-pink) 85%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      filter: drop-shadow(0 2px 18px #fa5a7211);
      text-shadow: 0 2px 8px #fff7;
    }
    .menu-btns { margin-bottom: 12px;}
    .btn-block {
      display: block;
      width: 100%;
      margin: 13px 0 0 0;
      padding: 16px 0;
      font-size: 1.14em;
      font-weight: 600;
      border: none;
      border-radius: 13px;
      background: linear-gradient(90deg, var(--main-blue) 0%, var(--main-pink) 100%);
      color: #fff;
      box-shadow: 0 2px 12px #3775dd26;
      cursor: pointer;
      letter-spacing: 0.5px;
      transition: background .17s, box-shadow .16s, transform .14s;
      position: relative;
      overflow: hidden;
      outline: none;
    }
    .btn-block:active {transform: scale(.97);}
    .btn-block:hover, #copyBtn:hover { 
      background: linear-gradient(90deg, var(--main-pink) 0%, var(--main-blue) 100%);
      transform: translateY(-1px) scale(1.04);
      box-shadow: 0 6px 26px #fa5a7240;
    }
    .ai-levels {
      display:flex;
      gap:10px;
      justify-content:center;
      margin-bottom: 10px;
      margin-top: 6px;
    }
    .ai-level-btn {
      padding: 8px 18px;
      border: none;
      border-radius: 8px;
      background: #eee;
      color: var(--main-blue);
      font-weight: 600;
      font-size: 1em;
      cursor: pointer;
      transition: background .12s, color .12s;
    }
    .ai-level-btn.selected, .ai-level-btn:active {
      background: var(--main-pink);
      color: #fff;
    }
    .board-outer {
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 10px;
      min-height: 340px;
    }
    .board-wrap {
      position: relative;
      width: 320px; height: 320px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .board {
      width: 320px; height: 320px;
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      grid-template-rows: repeat(3, 1fr);
      gap: 14px;
      background: none;
      position:relative;
      z-index: 2;
      filter: drop-shadow(0 2px 20px #5e6fff28);
    }
    .cell {
      aspect-ratio: 1/1;
      width: 100%; height: 100%;
      background: linear-gradient(140deg, #fff 60%, #f5eefa 100%);
      border-radius: 19px;
      font-size: 2.9em;
      font-weight: bold;
      color: var(--main-blue);
      cursor: pointer;
      user-select: none;
      border: 2.7px solid #c3d2f2;
      text-align:center;
      display: flex; align-items: center; justify-content: center;
      transition: background .15s, color .13s, box-shadow .14s, border-color .13s;
      outline: none;
      position: relative;
      z-index: 2;
      overflow: visible;
      filter: drop-shadow(0 0px 16px #fff5);
    }
    .cell.x { color: var(--main-blue);}
    .cell.o { color: var(--main-pink);}
    .cell.win { 
      background: linear-gradient(120deg, #fffed9 60%, #ffe68a 100%);
      color: var(--main-green); 
      border-color: var(--main-green); 
      box-shadow: 0 0 32px #ffe68a99,0 2px 16px #bdd7ff55;
      filter: drop-shadow(0 0 16px #ffe68a77);
    }
    .win-line {
      position: absolute;
      left: 0; top: 0;
      width: 320px; height: 320px;
      pointer-events: none;
      z-index: 3;
    }
    .win-line-line {
      stroke: #1fa960;
      stroke-width: 10px;
      stroke-linecap: round;
      filter: drop-shadow(0 0 8px #ffe68a) drop-shadow(0 0 22px #fff8);
      opacity: 0.95;
      stroke-dasharray: 330;
      stroke-dashoffset: 330;
      animation: winLineAnim 0.7s cubic-bezier(.15,.8,.36,1.3) forwards;
    }
    @keyframes winLineAnim {
      to { stroke-dashoffset: 0;}
    }
    .status {
      font-size: 1.17em;
      margin: 18px 0 10px 0;
      font-weight: 700;
      letter-spacing: .5px;
      min-height: 23px;
      color: #21213a;
      text-shadow: 0 1px 0 #fff2;
      text-align:center;
      filter: drop-shadow(0 1px 6px #fff6);
    }
    .footer {
      margin: 24px 0 0 0;
      color: #b7b7b7;
      font-size: 1.01em;
      letter-spacing: 0.2px;
      text-align: center;
      opacity: 0.97;
      text-shadow: 0 1px 0 #fff7;
    }
    @media (max-width:600px) {
      .container {max-width: 99vw;}
      .panel {max-width:99vw; padding: 6vw 2vw 8vw 2vw;}
      .board-outer, .board-wrap, .win-line, .board {width: 90vw; height: 90vw; max-width: 99vw; max-height: 99vw;}
      .cell {font-size:8vw;}
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="panel">
      <h1>Tic Tac Toe <span style="font-size:.75em;">(X-O)</span></h1>
      <div id="main-menu">
        <div class="menu-btns">
          <button class="btn-block" onclick="startLocal()">Lokal (bitta qurilmada)</button>
          <button class="btn-block" onclick="startOnline()">Do‘st bilan onlayn</button>
          <button class="btn-block" onclick="showAIlevels()">AI (bot) bilan o‘ynash</button>
        </div>
        <div class="ai-levels" id="ai-levels" style="display:none;">
          <button class="ai-level-btn" onclick="startAI('easy')" id="ai-easy">Oson</button>
          <button class="ai-level-btn" onclick="startAI('medium')" id="ai-medium">O‘rta</button>
          <button class="ai-level-btn" onclick="startAI('hard')" id="ai-hard">Qiyin</button>
        </div>
      </div>
      <div id="game" style="display:none; width:100%;">
        <div class="status" id="status"></div>
        <div class="board-outer">
          <div class="board-wrap">
            <div id="win-line"></div>
            <div class="board" id="board"></div>
          </div>
        </div>
        <button class="btn-block" id="restartBtn" style="display:none;" onclick="restartGame()">Qayta o‘ynash</button>
        <div id="share-block" class="link"></div>
        <button class="btn-block" style="margin-top:10px;" onclick="backToMenu()">Ortga</button>
      </div>
      <div class="footer">© <span id="year"></span> Tic Tac Toe | Hayotulloxon uchun maxsus</div>
      <div class="confetti" id="confetti"></div>
    </div>
  </div>
  <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
  <script>
    let board = Array(9).fill(null), turn="X", winner=null, lastWinLine=[], winLineType="";
    let mode = null, aiSymbol = "O", humanSymbol = "X", aiLevel = "easy";
    let mySymbol = "X", oppSymbol = "O";
    let gameId = null, socket = null;
    const boardDiv=document.getElementById("board"), statusDiv=document.getElementById("status");
    const winLineDiv=document.getElementById("win-line"), restartBtn=document.getElementById("restartBtn");
    const mainMenu = document.getElementById("main-menu");
    const gameDiv = document.getElementById("game");
    const shareBlock = document.getElementById("share-block");
    const aiLevels = document.getElementById("ai-levels");
    function showAIlevels() {
      aiLevels.style.display = "flex";
      document.getElementById("ai-easy").classList.remove("selected");
      document.getElementById("ai-medium").classList.remove("selected");
      document.getElementById("ai-hard").classList.remove("selected");
    }
    function startAI(level) {
      mode="ai"; aiLevel=level; winner=null; lastWinLine=[]; winLineType="";
      mainMenu.style.display="none";
      aiLevels.style.display="none";
      gameDiv.style.display="";
      board=Array(9).fill(null); turn=humanSymbol="X"; aiSymbol="O";
      renderBoard(); updateStatus(); drawWinLine(); restartBtn.style.display="none";
      document.getElementById("ai-" + level).classList.add("selected");
    }
    function startLocal() {
      mode="local"; winner=null; lastWinLine=[]; winLineType="";
      mainMenu.style.display="none";
      aiLevels.style.display="none";
      gameDiv.style.display="";
      board=Array(9).fill(null); turn="X";
      renderBoard(); updateStatus(); drawWinLine(); restartBtn.style.display="none";
    }
    function startOnline() {
      alert("Onlayn multiplayer uchun backend kerak va demo emas.");
    }
    function renderBoard() {
      boardDiv.innerHTML="";
      for(let i=0;i<9;i++) {
        let c="cell";
        if(board[i]) c+=" "+board[i].toLowerCase();
        if(lastWinLine.includes(i)) c+=" win";
        boardDiv.innerHTML+=`<div class="${c}" onclick="move(${i})">${board[i]||""}</div>`;
      }
    }
    function updateStatus() {
      if(mode==="local") {
        if(winner) statusDiv.textContent=winner==="draw"?"Durrang!":`G‘olib: ${winner}`;
        else statusDiv.textContent=`Navbat: ${turn}`;
      } else if(mode==="ai") {
        if(winner) statusDiv.textContent=winner==="draw"?"Durrang!":(winner===humanSymbol?"Siz yutdingiz!":"Bot yutdi!");
        else statusDiv.textContent=turn===humanSymbol?"Sizning navbatingiz":"Bot navbati...";
      }
    }
    function checkWinner() {
      const lines=[
        [0,1,2],[3,4,5],[6,7,8],
        [0,3,6],[1,4,7],[2,5,8],
        [0,4,8],[2,4,6]
      ], types=["row0","row1","row2","col0","col1","col2","main","anti"];
      for(let i=0;i<lines.length;i++){
        let [a,b,c]=lines[i];
        if(board[a]&&board[a]===board[b]&&board[a]===board[c]){winLineType=types[i]; return board[a];}
      }
      winLineType="";
      if(board.every(Boolean)) return "draw";
      return null;
    }
    function findWinLine(){
      const map=[
        {line:[0,1,2],type:"row0"},{line:[3,4,5],type:"row1"},{line:[6,7,8],type:"row2"},
        {line:[0,3,6],type:"col0"},{line:[1,4,7],type:"col1"},{line:[2,5,8],type:"col2"},
        {line:[0,4,8],type:"main"},{line:[2,4,6],type:"anti"}
      ];
      for(let m of map){
        let [a,b,c]=m.line;
        if(board[a]&&board[a]===board[b]&&board[a]===board[c])return {line:m.line,type:m.type};
      }
      return {line:[],type:""};
    }
    function drawWinLine() {
      let size=boardDiv.offsetWidth||320;
      let coords={
        row0:[[size*0.08,size*0.17],[size*0.92,size*0.17]],
        row1:[[size*0.08,size*0.5],[size*0.92,size*0.5]],
        row2:[[size*0.08,size*0.83],[size*0.92,size*0.83]],
        col0:[[size*0.17,size*0.08],[size*0.17,size*0.92]],
        col1:[[size*0.5,size*0.08],[size*0.5,size*0.92]],
        col2:[[size*0.83,size*0.08],[size*0.83,size*0.92]],
        main:[[size*0.09,size*0.09],[size*0.91,size*0.91]],
        anti:[[size*0.91,size*0.09],[size*0.09,size*0.91]]
      };
      let svg="";
      if(winLineType&&coords[winLineType]){
        let [start,end]=coords[winLineType];
        svg=`<svg class="win-line" width="${size}" height="${size}"><line class="win-line-line" x1="${start[0]}" y1="${start[1]}" x2="${end[0]}" y2="${end[1]}"/></svg>`;
      }
      winLineDiv.innerHTML=svg;
    }
    function move(idx){
      if(board[idx]||winner) return;
      if(mode==="local") {
        board[idx]=turn;
        winner=checkWinner();
        let found=findWinLine();
        lastWinLine=found.line; winLineType=found.type;
        turn=turn==="X"?"O":"X";
        renderBoard(); updateStatus(); drawWinLine();
        if(winner) restartBtn.style.display="";
      }
      else if(mode==="ai") {
        if(turn!==humanSymbol) return;
        board[idx]=humanSymbol;
        winner=checkWinner();
        let found=findWinLine();
        lastWinLine=found.line; winLineType=found.type;
        turn=aiSymbol;
        renderBoard(); updateStatus(); drawWinLine();
        if(winner) {restartBtn.style.display=""; return;}
        setTimeout(aiMove, 500);
      }
    }
    // AI with 3 levels: easy - random; medium - block/win; hard - simple minimax
    function aiMove() {
      if(winner) return;
      let idx;
      if(aiLevel==="easy") {
        let empties = [];
        for(let i=0;i<9;i++) if(!board[i]) empties.push(i);
        idx = empties[Math.floor(Math.random()*empties.length)];
      } else if(aiLevel==="medium") {
        idx = findBestMoveMedium(aiSymbol, humanSymbol);
        if(idx===-1) {
          let empties = [];
          for(let i=0;i<9;i++) if(!board[i]) empties.push(i);
          idx = empties[Math.floor(Math.random()*empties.length)];
        }
      } else { // hard
        idx = findBestMoveHard();
      }
      board[idx]=aiSymbol;
      winner=checkWinner();
      let found=findWinLine();
      lastWinLine=found.line; winLineType=found.type;
      turn=humanSymbol;
      renderBoard(); updateStatus(); drawWinLine();
      if(winner) restartBtn.style.display="";
    }
    function findBestMoveMedium(ai, human) {
      // Win
      for(let i=0;i<9;i++) {
        if(!board[i]) {
          board[i]=ai;
          if(checkWinner()===ai) {board[i]=null; return i;}
          board[i]=null;
        }
      }
      // Block
      for(let i=0;i<9;i++) {
        if(!board[i]) {
          board[i]=human;
          if(checkWinner()===human) {board[i]=null; return i;}
          board[i]=null;
        }
      }
      if(!board[4]) return 4; // center
      return -1;
    }
    function findBestMoveHard() {
      // Minimax (simple, for TicTacToe)
      function minimax(b, player) {
        let winnerX = checkWinnerBoard(b, "X");
        let winnerO = checkWinnerBoard(b, "O");
        if(winnerX) return {score: -1};
        if(winnerO) return {score: 1};
        if(b.every(Boolean)) return {score: 0};
        let moves = [];
        for(let i=0;i<9;i++) {
          if(!b[i]) {
            let move = {idx: i};
            b[i]=player;
            let result = minimax(b, player==="O"?"X":"O");
            move.score = result.score;
            moves.push(move);
            b[i]=null;
          }
        }
        if(player===aiSymbol) {
          let max = -Infinity, best=0;
          for(let i=0;i<moves.length;i++) if(moves[i].score>max) {max=moves[i].score; best=i;}
          return moves[best];
        } else {
          let min = Infinity, best=0;
          for(let i=0;i<moves.length;i++) if(moves[i].score<min) {min=moves[i].score; best=i;}
          return moves[best];
        }
      }
      let bestMove = minimax([...board], aiSymbol);
      return bestMove && bestMove.idx!==undefined ? bestMove.idx : findBestMoveMedium(aiSymbol, humanSymbol);
    }
    function checkWinnerBoard(b, symbol) {
      const lines=[
        [0,1,2],[3,4,5],[6,7,8],
        [0,3,6],[1,4,7],[2,5,8],
        [0,4,8],[2,4,6]
      ];
      for(let i=0;i<lines.length;i++){
        let [a,b1,c]=lines[i];
        if(b[a]===symbol&&b[b1]===symbol&&b[c]===symbol) return symbol;
      }
      return null;
    }
    function restartGame() {
      board=Array(9).fill(null); winner=null; lastWinLine=[]; winLineType="";
      if(mode==="ai") { turn=humanSymbol="X"; aiSymbol="O"; }
      else { turn="X"; }
      renderBoard();updateStatus();drawWinLine();restartBtn.style.display="none";
    }
    function backToMenu() {
      mode=null; winner=null;
      gameDiv.style.display="none";
      mainMenu.style.display="";
      aiLevels.style.display="none";
    }
    window.onload=function(){
      renderBoard();updateStatus();drawWinLine();
      document.getElementById("year").textContent=new Date().getFullYear();
    }
    window.addEventListener("resize",drawWinLine);
  </script>
</body>
</html>
