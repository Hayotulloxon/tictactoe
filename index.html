<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8">
  <title>Tic Tac Toe Multiplayer & AI (X-O)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root {
      --main-blue: #3775dd;
      --main-pink: #fa5a72;
      --main-green: #1fa960;
      --main-yellow: #ffe68a;
    }
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      min-height: 100vh;
      min-width: 100vw;
      background: radial-gradient(circle at 80% 10%, #ff48c7 0 18%, #ffd6e0 40%, #291a6d 100%),
                  radial-gradient(ellipse at 0% 100%, #d2eaff 0 22%, #9be7ff 60%, #291a6d 100%),
                  linear-gradient(120deg, #2b32b2 0%, #1488cc 100%);
      position: relative;
      font-family: 'Segoe UI', Arial, sans-serif;
      overflow-x: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .container {
      min-height: 100vh;
      width: 100vw;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 2vw 0 2vw 0;
    }
    .panel {
      background: rgba(255,255,255,0.97);
      border-radius: 28px;
      box-shadow: 0 8px 36px #0004, 0 1.5px 8px #3775dd33;
      position: relative;
      z-index: 1;
      backdrop-filter: blur(3.3px);
      border: 2.5px solid #fff8;
      max-width: 440px;
      width: 99vw;
      padding: 32px 18px 30px 18px;
      margin: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    h1 {
      text-align:center;
      letter-spacing: 1.5px;
      color: var(--main-blue);
      margin-top: 0;
      margin-bottom: 18px;
      font-size: 2.15em;
      font-weight: 800;
      background: linear-gradient(90deg, #fff 10%, var(--main-blue) 50%, var(--main-pink) 85%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      filter: drop-shadow(0 2px 18px #fa5a7211);
      text-shadow: 0 2px 8px #fff7;
    }
    .menu-btns { margin-bottom: 16px; width:100%;}
    .btn-block {
      display: block;
      width: 99%;
      min-width: 220px;
      margin: 16px auto 0 auto;
      padding: 26px 0;
      font-size: 1.25em;
      font-weight: 700;
      border: none;
      border-radius: 24px;
      background: linear-gradient(90deg, var(--main-blue) 0%, var(--main-pink) 100%);
      color: #fff;
      box-shadow: 0 2px 12px #3775dd26;
      cursor: pointer;
      letter-spacing: 1px;
      transition: background .17s, box-shadow .16s, transform .14s, width .13s;
      position: relative;
      overflow: hidden;
      outline: none;
    }
    .btn-block:active {transform: scale(.97);}
    .btn-block:hover { 
      background: linear-gradient(90deg, var(--main-pink) 0%, var(--main-blue) 100%);
      transform: translateY(-1px) scale(1.04);
      box-shadow: 0 6px 26px #fa5a7240;
    }
    .ai-levels {
      display: none;
      flex-direction: column;
      align-items: center;
      gap: 26px;
      margin-top: 40px;
      margin-bottom: 10px;
      width: 99%;
    }
    .ai-level-btn {
      width: 99%;
      max-width: 430px;
      padding: 34px 0;
      border: none;
      border-radius: 28px;
      background: linear-gradient(90deg, var(--main-blue) 30%, var(--main-pink) 100%);
      color: #fff;
      font-weight: 900;
      font-size: 1.58em;
      letter-spacing: 2px;
      cursor: pointer;
      box-shadow: 0 2px 12px #3775dd29;
      transition: background .14s, box-shadow .14s, transform .14s, width .13s;
      margin: 0 auto;
    }
    .ai-level-btn:active, .ai-level-btn.selected {
      background: linear-gradient(90deg, var(--main-pink) 10%, var(--main-blue) 80%);
      box-shadow: 0 6px 26px #fa5a7240;
      transform: scale(1.05);
    }
    .board-wrap {
      position: relative;
      width: 350px; height: 350px;
      margin: 48px auto 0 auto;
    }
    .board {
      width: 100%; height: 100%;
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      grid-template-rows: repeat(3, 1fr);
      gap: 14px;
      background: none;
      position:relative;
      z-index: 2;
      filter: drop-shadow(0 2px 20px #5e6fff28);
    }
    .cell {
      aspect-ratio: 1/1;
      width: 100%; height: 100%;
      background: linear-gradient(140deg, #fff 60%, #f5eefa 100%);
      border-radius: 19px;
      font-size: 3.2em;
      font-weight: bold;
      color: var(--main-blue);
      cursor: pointer;
      user-select: none;
      border: 2.7px solid #c3d2f2;
      text-align:center;
      display: flex; align-items: center; justify-content: center;
      transition: background .15s, color .13s, box-shadow .14s, border-color .13s;
      outline: none;
      position: relative;
      z-index: 2;
      overflow: visible;
      filter: drop-shadow(0 0px 16px #fff5);
    }
    .cell.x { color: var(--main-blue);}
    .cell.o { color: var(--main-pink);}
    .cell.win { 
      background: linear-gradient(120deg, #fffed9 60%, #ffe68a 100%);
      color: var(--main-green); 
      border-color: var(--main-green); 
      box-shadow: 0 0 32px #ffe68a99,0 2px 16px #bdd7ff55;
      filter: drop-shadow(0 0 16px #ffe68a77);
    }
    .win-line {
      position: absolute;
      left: 0; top: 0;
      width: 350px; height: 350px;
      pointer-events: none;
      z-index: 3;
    }
    .win-line-line {
      stroke: #1fa960;
      stroke-width: 10px;
      stroke-linecap: round;
      filter: drop-shadow(0 0 8px #ffe68a) drop-shadow(0 0 22px #fff8);
      opacity: 0.95;
      stroke-dasharray: 330;
      stroke-dashoffset: 330;
      animation: winLineAnim 0.7s cubic-bezier(.15,.8,.36,1.3) forwards;
    }
    @keyframes winLineAnim {
      to { stroke-dashoffset: 0;}
    }
    .status {
      font-size: 1.31em;
      margin: 18px 0 10px 0;
      font-weight: 700;
      letter-spacing: .5px;
      min-height: 23px;
      color: #21213a;
      text-shadow: 0 1px 0 #fff2;
      text-align:center;
      filter: drop-shadow(0 1px 6px #fff6);
    }
    .footer {
      margin: 27px 0 0 0;
      color: #b7b7b7;
      font-size: 1.01em;
      letter-spacing: 0.2px;
      text-align: center;
      opacity: 0.97;
      text-shadow: 0 1px 0 #fff7;
    }
    .bottom-btns {
      display: flex;
      flex-direction: row;
      gap: 25px;
      margin-top: 56px;
      margin-bottom: 2px;
      align-items: stretch;
      justify-content: center;
      width: 99%;
    }
    .bottom-btns .btn-block {
      width: 100%;
      min-width: 160px;
      margin: 0 !important;
      padding: 26px 0;
      font-size: 1.21em;
      border-radius: 18px;
      box-shadow: 0 1px 8px #b9baf944;
    }
    @media (max-width:600px) {
      .container {max-width: 99vw; padding: 7vw 2vw 24vw 2vw;}
      .panel {max-width:99vw;}
      .board-wrap, .win-line {width: 98vw; height: 98vw; max-width: 99vw; max-height: 99vw;}
      .cell {font-size:10vw;}
      .ai-level-btn {padding: 8vw 0; font-size: 1.13em;}
      .bottom-btns {margin-top: 12vw;}
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="panel">
      <h1>Tic Tac Toe <span style="font-size:.75em;">(X-O)</span></h1>
      <div id="main-menu">
        <div class="menu-btns" id="main-menu-btns">
          <button class="btn-block" onclick="startLocal()">Lokal (bitta qurilmada)</button>
          <button class="btn-block" onclick="showAIlevels()">AI (bot) bilan oâ€˜ynash</button>
          <button class="btn-block" onclick="startOnline()">Doâ€˜st bilan onlayn</button>
        </div>
        <div class="ai-levels" id="ai-levels">
          <button class="ai-level-btn" onclick="startAI('easy')" id="ai-easy">Oson</button>
          <button class="ai-level-btn" onclick="startAI('medium')" id="ai-medium">Oâ€˜rta</button>
          <button class="ai-level-btn" onclick="startAI('hard')" id="ai-hard">Qiyin</button>
        </div>
      </div>
      <div id="game" style="display:none;">
        <div class="status" id="status"></div>
        <div class="board-wrap">
          <div id="win-line"></div>
          <div class="board" id="board"></div>
        </div>
        <div class="bottom-btns">
          <button class="btn-block" id="restartBtn" style="display:none;" onclick="restartGame()">Qayta oâ€˜ynash</button>
          <button class="btn-block" onclick="backToMenu()">Ortga</button>
        </div>
        <div id="share-block" class="link"></div>
      </div>
      <div class="footer">Â© <span id="year"></span> Tic Tac Toe | Hayotulloxon uchun maxsus</div>
      <div class="confetti" id="confetti"></div>
    </div>
  </div>
  <script>
    let mode = null, aiSymbol = "O", humanSymbol = "X", aiLevel = 'easy', isHumanFirst = true;
    let board = Array(9).fill(null), turn = "X", winner = null, lastWinLine = [], winLineType = "";
    const mainMenu = document.getElementById("main-menu");
    const mainMenuBtns = document.getElementById("main-menu-btns");
    const aiLevelsDiv = document.getElementById("ai-levels");
    const gameDiv = document.getElementById("game");
    const statusDiv = document.getElementById("status");
    const boardDiv = document.getElementById("board");
    const winLineDiv = document.getElementById("win-line");
    const restartBtn = document.getElementById("restartBtn");
    const shareBlock = document.getElementById("share-block");
    const confettiDiv = document.getElementById("confetti");

    function showAIlevels() {
      mainMenuBtns.style.display = "none";
      aiLevelsDiv.style.display = "flex";
    }

    function startAI(level) {
      aiLevel = level;
      mode = "ai";
      isHumanFirst = true;
      humanSymbol = "X";
      aiSymbol = "O";
      turn = "X";
      board = Array(9).fill(null);
      winner = null;
      lastWinLine = [];
      winLineType = "";
      mainMenu.style.display = "none";
      aiLevelsDiv.style.display = "none";
      gameDiv.style.display = "";
      renderBoard();
      updateStatus();
      restartBtn.style.display = "none";
      clearConfetti();
      drawWinLine();
      // Agar bot birinchi yuradigan bo'lsa, bu yerda yurishi kerak
      if (turn === aiSymbol) setTimeout(aiMove, 500);
    }

    function startLocal() {
      mode = "local";
      board = Array(9).fill(null);
      turn = "X";
      winner = null;
      lastWinLine = [];
      winLineType = "";
      mainMenu.style.display = "none";
      aiLevelsDiv.style.display = "none";
      mainMenuBtns.style.display = "";
      shareBlock.innerHTML = "";
      gameDiv.style.display = "";
      renderBoard();
      updateStatus();
      restartBtn.style.display = "none";
      clearConfetti();
      drawWinLine();
    }

    function startOnline() {
      alert("Onlayn multiplayer uchun backend kerak va demo emas.");
    }

    function move(idx) {
      if (board[idx] || winner) return;
      if (mode === "local") {
        board[idx] = turn;
        winner = checkWinner();
        let found = findWinLine(board,true);
        lastWinLine = found.line;
        winLineType = found.type;
        turn = turn === "X" ? "O" : "X";
        renderBoard();
        updateStatus();
        if (winner) {
          restartBtn.style.display = "";
          if (lastWinLine.length > 0) fireConfetti();
        }
        drawWinLine();
      } else if (mode === "ai") {
        if (turn !== humanSymbol || winner) return;
        board[idx] = humanSymbol;
        winner = checkWinner();
        let found = findWinLine(board,true);
        lastWinLine = found.line;
        winLineType = found.type;
        turn = aiSymbol;
        renderBoard();
        updateStatus();
        if (winner) {
          restartBtn.style.display = "";
          if (lastWinLine.length > 0) fireConfetti();
          return;
        }
        drawWinLine();
        setTimeout(aiMove, 500);
      }
    }

    function aiMove() {
      if (winner || turn !== aiSymbol) return;
      let moveIdx;
      if (aiLevel === 'easy') {
        let empties = [];
        for (let i = 0; i < 9; i++) if (!board[i]) empties.push(i);
        moveIdx = empties[Math.floor(Math.random() * empties.length)];
      } else if (aiLevel === 'medium') {
        moveIdx = findBestMove(board, aiSymbol, humanSymbol);
        if (moveIdx === -1) {
          let empties = [];
          for (let i = 0; i < 9; i++) if (!board[i]) empties.push(i);
          moveIdx = empties[Math.floor(Math.random() * empties.length)];
        }
      } else {
        moveIdx = minimaxMove();
      }
      if (moveIdx === undefined || moveIdx === null) return;
      board[moveIdx] = aiSymbol;
      winner = checkWinner();
      let found = findWinLine(board,true);
      lastWinLine = found.line;
      winLineType = found.type;
      turn = humanSymbol;
      renderBoard();
      updateStatus();
      if (winner) {
        restartBtn.style.display = "";
        if (lastWinLine.length > 0) fireConfetti();
        return;
      }
      drawWinLine();
      // Agar keyingi yurish ham bot navbatida bo'lsa (masalan, qayta o'yinda O birinchi yuradigan bo'lsa), yana yur!
      if (turn === aiSymbol && !winner) setTimeout(aiMove, 500);
    }

    function minimaxMove() {
      function checkWinnerMini(b, symbol) {
        const lines = [
          [0,1,2],[3,4,5],[6,7,8],
          [0,3,6],[1,4,7],[2,5,8],
          [0,4,8],[2,4,6]
        ];
        for (let l of lines) {
          const [a,b1,c] = l;
          if (b[a] === symbol && b[b1] === symbol && b[c] === symbol) return symbol;
        }
        return null;
      }
      function minimax(b, player) {
        let winnerX = checkWinnerMini(b, "X");
        let winnerO = checkWinnerMini(b, "O");
        if(winnerX) return {score: winnerX === aiSymbol ? 1 : -1};
        if(winnerO) return {score: winnerO === aiSymbol ? 1 : -1};
        if(b.every(Boolean)) return {score: 0};
        let moves = [];
        for(let i=0;i<9;i++) {
          if(!b[i]) {
            let move = {idx: i};
            b[i]=player;
            let result = minimax(b, player==="O"?"X":"O");
            move.score = result.score;
            moves.push(move);
            b[i]=null;
          }
        }
        if(player===aiSymbol) {
          let max = -Infinity, best=0;
          for(let i=0;i<moves.length;i++) if(moves[i].score>max) {max=moves[i].score; best=i;}
          return moves[best];
        } else {
          let min = Infinity, best=0;
          for(let i=0;i<moves.length;i++) if(moves[i].score<min) {min=moves[i].score; best=i;}
          return moves[best];
        }
      }
      let bestMove = minimax([...board], aiSymbol);
      return bestMove && bestMove.idx!==undefined ? bestMove.idx : findBestMove(board, aiSymbol, humanSymbol);
    }

    function findBestMove(b, ai, human) {
      for (let i = 0; i < 9; i++) {
        if (!b[i]) {
          b[i] = ai;
          if (checkWinner() === ai) { b[i] = null; return i; }
          b[i] = null;
        }
      }
      for (let i = 0; i < 9; i++) {
        if (!b[i]) {
          b[i] = human;
          if (checkWinner() === human) { b[i] = null; return i; }
          b[i] = null;
        }
      }
      if (!b[4]) return 4;
      return -1;
    }

    function renderBoard() {
      boardDiv.innerHTML = "";
      for (let i = 0; i < 9; i++) {
        let c = "cell";
        if (board[i]) c += " " + board[i].toLowerCase();
        if (lastWinLine.includes(i)) c += " win";
        boardDiv.innerHTML += `<div class="${c}" onclick="move(${i})">${board[i] ? board[i] : ''}</div>`;
      }
    }

    function updateStatus() {
      if (mode === "local") {
        if (winner)
          statusDiv.textContent = winner === "draw" ? "Durrang!" : `Gâ€˜olib: ${winner}`;
        else
          statusDiv.textContent = `Navbat: ${turn}`;
      } else if (mode === "ai") {
        if (winner) {
          if (winner === humanSymbol) {
            statusDiv.textContent = "Siz yutdingiz! ðŸŽ‰";
          } else if (winner === aiSymbol) {
            statusDiv.textContent = "ðŸ¤– Bot yutdi!";
          } else {
            statusDiv.textContent = "Durrang!";
          }
        } else if (turn === humanSymbol) {
          statusDiv.textContent = "Sizning navbatingiz";
        } else {
          statusDiv.textContent = "ðŸ¤– Bot navbati...";
        }
      }
    }

    function checkWinner() {
      const lines = [
        [0,1,2],[3,4,5],[6,7,8],
        [0,3,6],[1,4,7],[2,5,8],
        [0,4,8],[2,4,6]
      ];
      for (let l of lines) {
        const [a,b,c] = l;
        if (board[a] && board[a] === board[b] && board[a] === board[c]) return board[a];
      }
      if (board.every(Boolean)) return 'draw';
      return null;
    }

    function findWinLine(b,withType) {
      const map = [
        { line: [0,1,2], type: "row0" }, { line: [3,4,5], type: "row1" }, { line: [6,7,8], type: "row2" },
        { line: [0,3,6], type: "col0" }, { line: [1,4,7], type: "col1" }, { line: [2,5,8], type: "col2" },
        { line: [0,4,8], type: "main" }, { line: [2,4,6], type: "anti" }
      ];
      for (let m of map) {
        const [a,b,c] = m.line;
        if (b[a] && b[a] === b[b] && b[a] === b[c]) return withType ? m : m.line;
      }
      return withType ? {line:[],type:""} : [];
    }

    function restartGame() {
      if (mode === "local") {
        board = Array(9).fill(null);
        turn = "X";
        winner = null;
        lastWinLine = [];
        winLineType = "";
        renderBoard();
        updateStatus();
        restartBtn.style.display = "none";
        clearConfetti();
        drawWinLine();
      } else if (mode === "ai") {
        isHumanFirst = !isHumanFirst;
        board = Array(9).fill(null);
        winner = null;
        humanSymbol = isHumanFirst ? "X" : "O";
        aiSymbol = isHumanFirst ? "O" : "X";
        turn = isHumanFirst ? "X" : "O";
        lastWinLine = [];
        winLineType = "";
        renderBoard();
        updateStatus();
        restartBtn.style.display = "none";
        clearConfetti();
        drawWinLine();
        if (turn === aiSymbol) setTimeout(aiMove, 500);
      }
    }

    function backToMenu() {
      mode = null;
      board = Array(9).fill(null);
      turn = "X";
      winner = null;
      lastWinLine = [];
      winLineType = "";
      mainMenu.style.display = "";
      aiLevelsDiv.style.display = "none";
      mainMenuBtns.style.display = "";
      gameDiv.style.display = "none";
      shareBlock.innerHTML = "";
      isHumanFirst = true;
      clearConfetti();
      drawWinLine();
    }

    function fireConfetti() {
      clearConfetti();
      const colors = [
        "var(--main-blue)", "var(--main-pink)", "var(--main-green)", "#ffd700", "#f7971e", "#7c77b9", "#fff"
      ];
      const pieces = 54;
      for(let i=0;i<pieces;i++) {
        let conf = document.createElement("div");
        conf.className = "confetti-piece";
        conf.style.background = colors[Math.floor(Math.random()*colors.length)];
        conf.style.left = (Math.random()*100) + "vw";
        conf.style.top = (-2-Math.random()*4) + "vh";
        conf.style.opacity = Math.random()*0.5 + 0.5;
        conf.style.transform = `rotate(${Math.random()*360}deg)`;
        confettiDiv.appendChild(conf);
      }
      setTimeout(clearConfetti, 2500);
    }
    function clearConfetti() {
      confettiDiv.innerHTML = "";
    }

    window.onload = function() {
      document.getElementById("year").textContent = new Date().getFullYear();
      aiLevelsDiv.style.display = "none";
    }
    window.addEventListener("resize", drawWinLine);
  </script>
</body>
</html>
